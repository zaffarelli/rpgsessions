# In CentOS, contents should be placed in the file /etc/sysconfig/celeryd
# Available options: http://celery.readthedocs.org/en/latest/tutorials/daemonizing.html#available-options

# Names of nodes to start (space-separated)
CELERYD_NODES="fetch files celery post cpe"

# Where to chdir at start. This could be the root of a virtualenv.
CELERYD_CHDIR="/var/run/celery"

# Absolute or relative path to the celery program
#CELERY_BIN="/usr/local/bin/celery"

# App instance to use (value for --app argument).
CELERY_APP="airshield"

AIRSHIELD_OVERCOMMIT=4
AIRSHIELD_NUM_CORES=$(nproc || echo 1)
AIRSHIELD_CONCURRENCY=$(expr $AIRSHIELD_NUM_CORES '*' $AIRSHIELD_OVERCOMMIT)
AIRSHIELD_POST_CONCURRENCY=$(expr $AIRSHIELD_NUM_CORES + 2)
AIRSHIELD_FILES_CONCURRENCY=$(expr 3 + $AIRSHIELD_NUM_CORES '/' 2)

# Extra arguments
CELERYD_OPTS="-A $CELERY_APP -Q:fetch fetch --concurrency:fetch=24 -Q:files files --concurrency:files=$AIRSHIELD_FILES_CONCURRENCY -Ofair:fetch -Ofair:files -Ofair:post -Q:celery celery --concurrency:celery=$AIRSHIELD_CONCURRENCY -Q:post post --concurrency:post=$AIRSHIELD_POST_CONCURRENCY -Q:cpe cpe --concurrency:cpe=8 -Ofair:cpe"

# Create log/pid dirs, if they don't already exist
CELERY_CREATE_DIRS=1

# - %n will be replaced with the first part of the nodename.
# - %I will be replaced with the current child process index
#   and is important when using the prefork pool to avoid race conditions.
#CELERYD_LOG_FILE="/path/to/my_application/log/%n%I.log"
#CELERYD_PID_FILE="/var/run/celery/%n.pid"

CELERYD_LOG_FILE="/var/log/airshield/airshield.log"

# you can pick DEBUG, INFO, WARNING, ERROR, CRITICAL, or FATAL here
# CELERYD_LOG_LEVEL="INFO"
CELERYD_LOG_LEVEL="ERROR"

# Workers run as an unprivileged user
CELERYD_USER=www-data
CELERYD_GROUP=www-data
